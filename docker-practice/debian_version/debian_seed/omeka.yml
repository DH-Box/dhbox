---
- name: Make sure that the Omeka directory exists
  sudo: true
  action: file path={{ omekadir }} state=directory
- name: Get Omeka
  get_url: dest=/tmp/omeka.zip  url=http://omeka.org/files/omeka-2.1.4.zip
- name: Unpack Omeka
  command: unzip -qo /tmp/omeka.zip -d {{ omekadir }}
- name: Move Omeka files
  raw: cp -r {{ omekadir }}/omeka-2.1.4/* {{ omekadir }}
- name: Move .htaccess
  raw: cp -r {{ omekadir }}/omeka-2.1.4/.htaccess {{ omekadir }}
- name: delete old Omeka directory
  raw: rm -rf {{ omekadir }}/omeka-2.1.4/
- include: omeka/playbook.yml
- name: Wait for Omeka
  wait_for: timeout=10
- name: restart apache2
  service: name=apache2 state=restarted
# - name: configure Omeka superuser with wget
#   raw: 'wget -O /tmp/install.html --post-data "username={{ admin.name }}&password={{ admin.password }}&password_confirm={{ unhashed_pass }}&super_email=dhbox@dhbox.org&administrator_email=dhbox@dhbox.org&site_title=DHBox&description=DHBox&copyright=2014&author=DHBOX&tag_delimiter=,&fullsize_constraint=800&thumbnail_constraint=200&square_thumbnail_constraint=200&per_page_admin=10&per_page_public=10&show_empty_elements=0&path_to_convert=/usr/bin&install_submit=Install" localhost:8080/install/'